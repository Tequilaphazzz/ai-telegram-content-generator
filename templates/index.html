<!DOCTYPE html>
<html lang="en"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Post Generator</title> <style>
        body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; background-color: #f4f4f9; color: #333; }
        h1, h2 { color: #444; }
        .container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea, input[type="text"] { width: 95%; padding: 10px; border-radius: 4px; border: 1px solid #ddd; margin-bottom: 10px; }
        button { background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 10px; }
        button.danger { background-color: #dc3545; }
        button.success { background-color: #28a745; }
        button:disabled { background-color: #ccc; }
        img { max-width: 100%; border-radius: 4px; }
        .error { background-color: #f8d7da; color: #721c24; padding: 10px; border: 1px solid #f5c6cb; border-radius: 4px; margin-top: 20px; }
        .result { border-left: 4px solid #007bff; padding-left: 15px; margin-top: 15px; }
        .result p { white-space: pre-wrap; }
        .final-publish button { width: 100%; padding: 20px; font-size: 24px; }
    </style>
</head>
<body>

    <h1>Telegram Content Generator</h1> {% if job.error %}
        <div class="error">
            <h2>Error!</h2> <p>{{ job.error }}</p>
        </div>
    {% endif %}

    {% if not job or job.status == 'error' %}
    <div class="container">
        <h2>Step 1: Set a topic for the post</h2> <form method="post">
            <input type="text" name="topic" placeholder="Example: 'Why cats rule the internet'" required> <button type="submit" name="action" value="start_generation">Generate!</button> </form>
    </div>
    {% endif %}

    {% if job and job.status != 'finished' %}
    <div class="container">
        <h2>Generation process for topic: "{{ job.topic }}"</h2> {% if job.post_text %}
        <div class="result">
            <h3>Post Text:</h3> <p>{{ job.post_text }}</p>
            {% if job.status == 'text_generation' %}
            <form method="post" style="display: inline;">
                <button type="submit" name="action" value="approve_text" class="success">Yes, great text!</button> <button type="submit" name="action" value="regenerate_text" class="danger">No, redo it</button> </form>
            {% else %}
            <p><strong>✅ Text approved</strong></p> {% endif %}
        </div>
        <hr>
        {% endif %}

        {% if job.post_image %}
        <div class="result">
            <h3>Post Image:</h3> <img src="{{ job.post_image }}?v={{ range(1, 1000) | random }}" alt="Generated image"> {% if job.status == 'image_generation' %}
            <form method="post" style="display: inline;">
                <button type="submit" name="action" value="approve_image" class="success">Yes, super picture!</button> <button type="submit" name="action" value="regenerate_image" class="danger">No, get another one</button> </form>
            {% else %}
            <p><strong>✅ Image approved</strong></p> {% endif %}
        </div>
        <hr>
        {% endif %}

        {% if job.story_image %}
        <div class="result">
            <h3>Story Preview (with headline):</h3> <h4>Headline: "{{ job.story_headline }}"</h4> <img src="{{ job.story_image }}?v={{ range(1, 1000) | random }}" alt="Generated story"> {% if job.status == 'headline_generation' %}
            <form method="post" style="display: inline;">
                <button type="submit" name="action" value="approve_all" class="success">Yes, the headline fits!</button> <button type="submit" name="action" value="regenerate_headline" class="danger">No, new headline</button> </form>
            {% else %}
            <p><strong>✅ Story approved</strong></p> {% endif %}
        </div>
        <hr>
        {% endif %}

        {% if job.status == 'approved' %}
        <div class="final-publish">
            <h2>Everything is ready for publication!</h2> <form method="post">
                <button type="submit" name="action" value="publish" class="success">PUBLISH TO TELEGRAM</button> </form>
        </div>
        {% endif %}

        {% if job.status == 'publishing' %}
            <p><strong>Publishing... Please wait.</strong></p> {% endif %}

    </div>
    {% endif %}

    {% if job.status == 'finished' %}
    <div class="container">
        <h2>Publication complete!</h2> <p>{{ job.publish_result }}</p>
        <form method="post">
            <button type="submit" name="action" value="reset">Create a new post</button> </form>
    </div>
    {% endif %}

</body>
</html>
